!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.swipegraph=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},r=function(){function e(n){t(this,e),this.elem=n,this.readyState="waiting",this.$eventList={}}return n(e,[{key:"$setMounted",value:function(e){this.readyState="mounted",this.dispatch("mounted",e)}},{key:"addSrcIndex",value:function(e){return this.dispatch("addSrcIndex",e),this}},{key:"setSrcIndex",value:function(e){return this.dispatch("setSrcIndex",e),this}},{key:"detach",value:function(){this.dispatch("$detach")}},{key:"on",value:function(e,t){return this.$eventList[e]=this.$eventList[e]||[],this.$eventList[e].push(t),this}},{key:"off",value:function(e,t){if(this.$eventList[e]){var n=this.$eventList[e].indexOf(t);-1!==n&&this.$eventList[e].splice(n,1)}return this}},{key:"one",value:function(e,t){var n=this;return this.on(e,function i(r){t.call(n,r),n.off(e,i)}),this}},{key:"dispatch",value:function(e,t){var n=this;return this.$eventList[e]&&this.$eventList[e].forEach(function(i){i.call(n,{type:e,value:t,target:n})}),this}}]),e}();var o="swipegraph-isinit",a=function(e,t){return Object.assign(["id","src","ref"].reduce(function(t,n){return Object.assign({},t,i({},n,e.getAttribute("data-"+n)))},{}),["length","autoswipe"].reduce(function(t,n){return Object.assign({},t,i({},n,JSON.parse(e.getAttribute("data-"+n))))},{}),t)},u=function(e){var t=e.$auth?"?"+e.$auth:"";return Object.assign({queryString:t,cdnQueryString:e.$cdnAuth?"?"+e.$cdnAuth:t,autoswipe:!0},e)},c=function(e){var t=0;window.addEventListener("scroll",function(){var n=window.scrollY;if(!(Math.abs(n-t)<20)){var i,r,o=n-t<0?-1:1;(i=e,r=[],i.forEach(function(e){var t=e.elem.getBoundingClientRect(),n=window.innerHeight;t.top<n&&t.top>-t.height&&r.push(e)}),r).forEach(function(e){e.addSrcIndex(o)}),t=n}},!1)},s=function(e,t){Object.keys(t).forEach(function(n){e.style[n]=t[n]})},f=window.URL||window.webkitURL,d=s,l=function(e,t,n){var i=!1,r=!1,o=null,a=null,u=1,c=-1,s=[],l=new Image;e.appendChild(l),l.onload=function(t){var i=t.target,r=i.naturalHeight,o=i.naturalWidth;e.style.paddingTop=r/o*100+"%",i.onload=null,d(l,{width:"100%",height:"100%",position:"absolute",top:0,left:0,backfaceVisibility:"hidden"}),n.$setMounted({width:o,height:r})};var h=document.createElement("div");d(h,{width:"100%",height:"100%",position:"absolute",zIndex:1e6,top:0,left:0}),e.appendChild(h);var p=function(e){e.preventDefault(),i=!0,r=!0,h.style.position="fixed"},v=function(){r=!1,h.style.position="absolute"};h.addEventListener("mousedown",p,!1),h.addEventListener("touchstart",p,!1),h.addEventListener("mouseup",v,!1),h.addEventListener("touchend",v,!1);var y=setInterval(function(){if(0!==u){var e=(c+u)%t.length;e<0&&(e+=t.length);var n,i,r,o=c=e;s[o]?l.src=s[o]:(n=t.src+"/"+t.id+"/"+(o+1)+".jpg"+t.queryString,i=function(e){s[o]=e,l.src=e},(r=new XMLHttpRequest).open("GET",n),r.responseType="blob",r.onload=function(e){return i(f.createObjectURL(e.target.response))},r.send()),u=0}},33),b=function(e){if(r||!i){var t="number"==typeof e.clientX?e.clientX:e.touches[0].pageX,n="number"==typeof e.clientY?e.clientY:e.touches[0].pageY;null===o?(o=t,a=n):Math.abs(t-o)>Math.abs(n-a)?(u=t-o>0?-1:1,o=t,a=n):(u=n-a>0?-1:1,o=t,a=n)}};n.on("addSrcIndex",function(e){return u=e.value}),n.on("$detach",function(){s.forEach(function(e){return URL.revokeObjectURL(e)}),clearInterval(y)}),h.addEventListener("mousemove",b,!1),h.addEventListener("touchmove",b,!1)};Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0});var h=o,p=a,v=u,y=s,b=[];c(b);var g={version:"0.2.0",config:{autoEmbed:!0},refs:{},attach:function(e,t){if(new RegExp(h).test(e.className))return b.find(function(t){return t.elem===e});e.classList.add(h);var n=p(e,t),i=new r(e);b.push(i),n.ref&&(g.refs[n.ref]=i);var o=document.createElement("div");y(o,{position:"relative"}),e.appendChild(o);var a=v(n);return l(o,a,i),i.on("$detach",function(e){var t=e.target;t.elem.classList.remove(h);var n=b.indexOf(t);-1!==n&&b.splice(n,1),Object.keys(g.refs).forEach(function(e){g.refs[e]===t&&(g.refs[e]=null,delete g.refs[e])}),t.elem.removeChild(o)}),i},detach:function(e){var t=b.find(function(t){return t.elem===e});t&&t.detach()}};if("object"===("undefined"==typeof window?"undefined":e(window))){var w=function(){Array.prototype.forEach.call(document.querySelectorAll(".swipegraph"),function(e){g.attach(e)})};setTimeout(function(){g.config.autoEmbed&&("loading"!==document.readyState?w():window.addEventListener("DOMContentLoaded",w,!1))}),console.log("SwipeGraph v0.2.0")}return g});
//# sourceMappingURL=swipegraph.min.js.map
