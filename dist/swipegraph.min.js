var swipegraph=function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};function a(t,e,n){t.$iframe&&t.$iframe.contentWindow?t.$iframe.contentWindow.postMessage({type:e,value:n},"*"):t.dispatch("$"+e,n)}var r=function(){function t(n){e(this,t),this.elem=n,this.readyState="waiting",this.$iframe=null,this.$isInit=!1,this.$info=null,this.$eventList={}}return n(t,[{key:"$setInfo",value:function(t,e){this.$info=t,this.readyState="loadedinfo",this.dispatch("loadedinfo",e),t.autoplay&&this.$init()}},{key:"$setMounted",value:function(){this.readyState="mounted",this.dispatch("mounted",null)}},{key:"$setIframe",value:function(t){"mounted"!==this.readyState&&this.$setMounted(),this.$iframe=t,this.readyState="loading",this.dispatch("loadstart",null)}},{key:"$iframeDidMount",value:function(){this.readyState="loaded",this.dispatch("loaded",null),this.requestFullscreen()}},{key:"$init",value:function(){this.$isInit=!0}},{key:"addSrcIndex",value:function(t){return a(this,"addSrcIndex",t),this}},{key:"setSrcIndex",value:function(t){return a(this,"setSrcIndex",t),this}},{key:"setFilter",value:function(t){return a(this,"setFilter",t),this}},{key:"setPosterIndex",value:function(t){return a(this,"setPosterIndex",t),this}},{key:"detach",value:function(){this.$iframe&&this.$iframe.contentWindow.postMessage({type:"detach"},"*"),this.dispatch("$detach")}},{key:"on",value:function(t,e){return this.$eventList[t]=this.$eventList[t]||[],this.$eventList[t].push(e),this}},{key:"off",value:function(t,e){if(this.$eventList[t]){var n=this.$eventList[t].indexOf(e);-1!==n&&this.$eventList[t].splice(n,1)}return this}},{key:"one",value:function(t,e){var n=this;return this.on(t,function i(a){e.call(n,a),n.off(t,i)}),this}},{key:"getInfo",value:function(t){var e=this;return"waiting"===this.readyState?this.one("loadedinfo",function(n){t.call(e,n.value)}):t.call(this,this.$info),this}},{key:"dispatch",value:function(t,e){var n=this;return this.$eventList[t]&&this.$eventList[t].forEach(function(i){i.call(n,{type:t,value:e,target:n})}),this}}]),t}();var o="swipegraph-isinit",s=function(t,e){var n=Object.assign(["cid","src","ref","filter"].reduce(function(e,n){return Object.assign({},e,i({},n,t.getAttribute("data-"+n)))},{}),["fps","quality","head","lazyload","swipingwidth","autoswipe"].reduce(function(e,n){return Object.assign({},e,i({},n,JSON.parse(t.getAttribute("data-"+n))))},{}),e),a={};return Object.keys(n).forEach(function(t){var e=n[t];if(null!==e)switch(t){case"src":var i=e.match(/\/([^/]+?\.[^/]+?)($|\?)/);a.src=null===i?/\/$/.test(e)?e.slice(0,-1):e:e.slice(0,i.index),a.iframeSrc=e;break;case"cid":a.contentId=e;break;case"head":a.headIndex=e;break;case"swipingwidth":a.swipingWidth=e;break;default:a[t]=e}}),a},u=function(t){var e=t.$auth?"?"+t.$auth:"";return Object.assign({queryString:e,cdnQueryString:t.$cdnAuth?"?"+t.$cdnAuth:e,contentId:"",headIndex:0,quality:.5,loop:!1,muted:!1,controls:!0,autoplay:!1,showingTitle:!0,swipingWidth:20,filter:"",iconcolor:"#E60014",iconhover:!1,allowfullscreen:!0,autoswipe:!0},t)},d=function(t){var e=0;window.addEventListener("scroll",function(){var n=window.scrollY;if(!(Math.abs(n-e)<20)){var i,a,r=n-e<0?-1:1;(i=t,a=[],i.forEach(function(t){if(t.$info&&t.$info.autoswipe){var e=t.elem.getBoundingClientRect(),n=window.innerHeight;e.top<n&&e.top>-e.height&&a.push(t)}}),a).forEach(function(t){t.addSrcIndex(r)}),e=n}},!1)},l=function(t,e){Object.keys(e).forEach(function(n){t.style[n]=e[n]})},c=l,h=function(){function t(){e(this,t),this.loaded=0,this.total=1;var n=document.createElement("div");c(n,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,70px)"});var i=document.createElement("div");c(i,{textAlign:"center",color:"#555",fontSize:"12px"}),i.innerText="/",n.appendChild(i);var a=document.createElement("div");c(a,{width:"200px",height:"5px",background:"#ccc",marginTop:"5px",position:"relative"}),n.appendChild(a);var r=document.createElement("div");c(r,{width:"0px",height:"100%",background:"#5699d2",position:"absolute",top:0,left:0}),a.appendChild(r),this.container=n,this.textElem=i,this.barElem=r}return n(t,[{key:"update",value:function(t,e){this.textElem.innerText=Math.floor(t/102.4/1024)/10+" / "+Math.floor(e/102.4/1024)/10+"MB",this.barElem.style.width=t/e*100+"%"}}]),t}(),f=l,p=function(){function t(){e(this,t),this.loaded=0,this.total=1;var n=document.createElement("div");f(n,{position:"absolute",bottom:0,left:0,right:0});var i=document.createElement("div");f(i,{width:"0%",height:"5px",background:"#f00"}),n.appendChild(i),this.container=n,this.barElem=i}return n(t,[{key:"update",value:function(t,e){this.barElem.style.width=t/e*100+"%"}}]),t}(),m=function(t,e,n,i,a){var r=URL.createObjectURL(t),o=new p,s=[],u=0,d=function t(a,d,l,c){d.ontimeupdate=function(){d.ontimeupdate=null,l.drawImage(d,0,0),function(t,e,n,i){if(t.toBlob)t.toBlob(e,n,i);else{for(var a=atob(t.toDataURL(n,i).split(",")[1]),r=a.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=a.charCodeAt(s);e(new Blob([o],{type:n}))}}(c,function(t){s[a]=URL.createObjectURL(t),e.length=0,Array.prototype.push.apply(e,s.filter(function(t){return!!t})),e.length===u?(s=null,i.removeChild(o.container),URL.revokeObjectURL(r)):o.update(e.length,u)},"image/jpeg",n.quality),a<u-1&&t(a+1,d,l,c)},d.currentTime=a/n.fps},l=document.createElement("video");u=Math.floor(l.duration*n.fps),l.playsinline=1,l.oncanplaythrough=function(t){var e=t.target;a(e.videoWidth,e.videoHeight),i.appendChild(o.container),e.oncanplaythrough=null,u=Math.floor(e.duration*n.fps);var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight,d(0,e,r.getContext("2d"),r)},l.src=r,l.load()},v=l,g=function(t,e,n,i,a){var r=!1,o=!1,s=null,u=null,d=0;e.innerHTML="",e.style.paddingTop=a/i*100+"%";var l=new Image;v(l,{width:"100%",height:"100%",position:"absolute",top:0,left:0,backfaceVisibility:"hidden"}),e.appendChild(l);var c=document.createElement("div");v(c,{width:"100%",height:"100%",position:"absolute",zIndex:1e6,top:0,left:0}),e.appendChild(c);var h=function(t){t.preventDefault(),r=!0,o=!0,c.style.position="fixed"},f=function(){o=!1,c.style.position="absolute"};c.addEventListener("mousedown",h,!1),c.addEventListener("touchstart",h,!1),c.addEventListener("mouseup",f,!1),c.addEventListener("touchend",f,!1);var p=function(e){if(0!==t.length){var n=(d+e)%t.length;n<0&&(n+=t.length),d=n}},m=function e(){var n=0===d?1:d;t[n]?l.src=t[n]:setTimeout(e,16)},g=function(t){if(o||!r&&n.autoswipe){var e="number"==typeof t.clientX?t.clientX:t.touches[0].pageX,i="number"==typeof t.clientY?t.clientY:t.touches[0].pageY;if(null===s)s=e,u=i;else if(Math.abs(e-s)>Math.abs(i-u)){p(e-s>0?-1:1);var a=s;setTimeout(function(){return p(e-a>0?-1:1)},33),m(),s=e,u=i}else{p(i-u>0?-1:1);var d=u;setTimeout(function(){return p(i-d>0?-1:1)},33),m(),s=e,u=i}}};c.addEventListener("mousemove",g,!1),c.addEventListener("touchmove",g,!1),m()},y=o,b=s,w=u,x=l,$=[],E=[];d($);var k={version:"0.1.0",config:{autoEmbed:!0},refs:{},attach:function(t,e){if(new RegExp(y).test(t.className))return $.find(function(e){return e.elem===t});t.classList.add(y);var n=b(t,e),i=new r(t);$.push(i),n.ref&&(k.refs[n.ref]=i);var a=document.createElement("div");x(a,{paddingTop:"56.25%",position:"relative"}),a.innerHTML='<svg style="position:absolute;top:50%;left:50%;margin:-100px 0 0 -100px;" width="200" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><g transform="rotate(0 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(30 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(60 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.75s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(90 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(120 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(150 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.5s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(180 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(210 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(240 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.25s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(270 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(300 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"></animate>\n</rect>\n</g><g transform="rotate(330 50 50)">\n<rect x="47" y="24" rx="9.4" ry="4.8" width="6" height="12" fill="#5699d2">\n  <animate attributeName="opacity" values="1;0" times="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animate>\n</rect>\n</g></svg>',t.appendChild(a);var o=new h;a.appendChild(o.container);var s=w(n);i.$setInfo(s);var u=s.iframeSrc+"/"+s.contentId+"/video.mp4",d=E.find(function(t){return t.originPath===u});if(d)g(d.data,a,s,d.width,d.height);else{var l={originPath:u,width:null,height:null,data:[]};E.push(l);var c=new XMLHttpRequest;c.open("GET",u),c.responseType="blob",c.onload=function(t){m(t.target.response,l.data,s,a,function(t,e){l.width=t,l.height=e,g(l.data,a,s,t,e)})},c.onprogress=function(t){t.lengthComputable&&o.update(t.loaded,t.total)},c.send()}return i.on("$detach",function(t){var e=t.target;e.elem.classList.remove(y);var n=$.indexOf(e);-1!==n&&$.splice(n,1),Object.keys(k.refs).forEach(function(t){k.refs[t]===e&&(k.refs[t]=null,delete k.refs[t])}),e.elem.removeChild(a)}),i},detach:function(t){var e=$.find(function(e){return e.elem===t});e&&e.detach()}};if("object"===("undefined"==typeof window?"undefined":t(window))){var L=function(){Array.prototype.forEach.call(document.querySelectorAll(".swipegraph"),function(t){k.attach(t)})};setTimeout(function(){k.config.autoEmbed&&("loading"!==document.readyState?L():window.addEventListener("DOMContentLoaded",L,!1))}),console.log("SwipeGraph v0.1.0")}return k}();
//# sourceMappingURL=swipegraph.min.js.map
